<html>
  <title>Etherpad for WebDav</title>
  <head>
    <script>
     function xhr(verb, url, data, callback) {
         const req = new XMLHttpRequest();
         req.onreadystatechange = function() {
             if (req.readyState == 4) {
                 callback(req);
             }
         }
         req.open(verb, url, true);
         req.send(data);
     }

     function GetLocationData() {
         const result = {};
         const params = window.location.search.slice(1).split('&');
         for (var i = 0; i < params.length; i++) {
             const idx = params[i].indexOf('=');
             if (idx > 0) {
                 result[decodeURIComponent(params[i].substring(0, idx))] = decodeURIComponent(params[i].substring(idx + 1));
             }
         }
         return result;
     }

     function Load() {
         xhr("GET", GetLocationData()['file'], "", function(req) {
             var formData = new FormData();
             formData.append(
                 'file', new Blob([req.responseText], {type: "text/plain"})
             );
             xhr("POST", "/p/webdav/import", formData, function(_) {});
         });
     }

     function Save() {
         xhr("GET", "/p/webdav/export/txt", "", function(req) {
             xhr("PUT", GetLocationData()['file'], req.responseText, function(_) {});
         });
     }
    </script>
  </head>
  <body style="margin:0;" onload="Load()">
    <div style="margin:10px;">
      <button onclick="Load()">Load</button>
      <button onclick="Save()">Save</button>
    </div>
    <iframe id="myFrame" style="width:100%;height:100vh;border:0;" src="/p/webdav" allow="camera"></iframe>
  </body>
</html>
