import{t as V,r as h,h as w,G as c,w as q,x as A,k as g,o,y as s,z as i,U as p,T as n,m as _,A as k,B as v,W as S,V as b,n as F,s as E,g as O,F as Q,O as R,f as U,a7 as z,a8 as W,_ as j}from"./userStore-DI58VgZ6.js";import{t as G,v as X,aq as Y,ap as $}from"./index-bkhK2U3_.js";import{p as J,S as K,b as Z}from"./index-Dvdk0smA.js";import{d as ee}from"./downloadService-C6bGKWwx.js";import{u as te,p as x}from"./app-Dh_3ddLE.js";import{b as ae,B as y}from"./Btn-2hiIT76k.js";import{S as oe}from"./ScreenHeaderSkeleton-BPPtSZSV.js";import"./TextInput.vue_vue_type_script_setup_true_lang-Cn7Fe5WG.js";import"./usePlaylistManagement-BYa-nJNx.js";import"./common-Qp7bRr50.js";import"./SoundBars-BQEuboqd.js";import"./index-SJV2sFs2.js";import"./index-BBRRzm9T.js";const C=d=>(z("data-v-9dc09b7d"),d=d(),W(),d),se=C(()=>n("p",{class:"text-base font-normal text-k-text-secondary"},"Episode",-1)),ie=["title"],ne={class:"text-2xl text-k-text-secondary"},re=["href"],le=["src"],ce={class:"flex gap-2"},de={key:0},ue=C(()=>n("h3",{class:"text-3xl font-semibold mb-4"},"Description",-1)),pe=["innerHTML"],_e=V({__name:"EpisodeScreen",setup(d){const{onScreenActivated:B,getRouteParam:P,triggerNotFound:D}=te(),u=h(!1),l=h(),e=h(),I=w(()=>{var t;return J.sanitize(((t=e==null?void 0:e.value)==null?void 0:t.episode_description)??"")}),N=async()=>{e.value=await E.resolve(l.value)},H=async()=>{var r;if(c.queueIfNotQueued(e.value),f.value){x.pause();return}if(((r=c.current)==null?void 0:r.id)===l.value){await x.resume();return}const t=await O.resolve(e.value.podcast_id);let a=Math.min(e.value.length,t.state.progresses[e.value.id]||0);a>=e.value.length&&(a=0),Q.continuous_playback&&c.replaceQueueWith(R.orderBy(await E.fetchForPodcast(e.value.podcast_id),"created_at")),await x.play(e.value,a)},M=()=>ee.fromPlayables(e.value),f=w(()=>{var t,a;return((t=c.current)==null?void 0:t.playback_state)==="Playing"&&((a=c.current)==null?void 0:a.id)===l.value});q(l,async t=>{if(!(!t||u.value)){u.value=!0;try{await N()}catch(a){ae().handleHttpError(a,{404:()=>D()})}finally{u.value=!1}}});const T=t=>{e.value&&U.emit("PLAYABLE_CONTEXT_MENU_REQUESTED",t,e.value)};return B("Episode",()=>l.value=P("id")),(t,a)=>{const r=A("Icon"),m=g("koel-tooltip"),L=g("koel-new-tab");return o(),s(Z,{onContextmenu:k(T,["prevent"])},{header:i(()=>[u.value&&!e.value?(o(),s(oe,{key:0})):p("",!0),e.value?(o(),s(K,{key:1},{thumbnail:i(()=>[n("img",{src:e.value.episode_image,class:"aspect-square object-cover",alt:"Episode thumbnail"},null,8,le)]),controls:i(()=>[n("div",ce,[_((o(),s(y,{highlight:"",onClick:k(H,["prevent"])},{default:i(()=>[f.value?(o(),s(r,{key:0,icon:v(G),"fixed-width":""},null,8,["icon"])):(o(),s(r,{key:1,icon:v(X),"fixed-width":""},null,8,["icon"]))]),_:1},8,["onClick"])),[[m,f.value?"Pause":"Play"]]),_((o(),s(y,{gray:"",onClick:k(M,["prevent"])},{default:i(()=>[S(r,{icon:v(Y),"fixed-width":""},null,8,["icon"])]),_:1},8,["onClick"])),[[m,"Download"]]),e.value.episode_link?_((o(),s(y,{key:0,href:e.value.episode_link,gray:"",tag:"a",target:"_blank"},{default:i(()=>[S(r,{icon:v($),"fixed-width":""},null,8,["icon"])]),_:1},8,["href"])),[[m,"Visit episode webpage"]]):p("",!0)])]),default:i(()=>[se,n("h1",{class:"text-ellipsis overflow-hidden whitespace-nowrap",title:e.value.title},b(e.value.title),9,ie),n("h2",ne,[n("a",{href:`/#/podcasts/${e.value.podcast_id}`,class:"!text-k-text-primary hover:!text-k-accent font-normal"},b(e.value.podcast_title),9,re)])]),_:1})):p("",!0)]),default:i(()=>[e.value?(o(),F("div",de,[ue,_(n("div",{class:"description text-k-text-secondary",innerHTML:I.value},null,8,pe),[[L]])])):p("",!0)]),_:1},8,["onContextmenu"])}}}),Be=j(_e,[["__scopeId","data-v-9dc09b7d"]]);export{Be as default};
