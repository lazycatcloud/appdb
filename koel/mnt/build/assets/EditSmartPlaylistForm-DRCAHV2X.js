import{t as L,ac as M,c as R,a3 as q,O as v,x as H,k as h,o as r,y as w,z as s,T as n,A as p,au as Y,W as t,Y as u,m as g,n as d,a0 as k,a1 as b,V as z,B as a,U as W,b as j,f as J}from"./userStore-DI58VgZ6.js";import{P as Q}from"./index-bkhK2U3_.js";import{u as X,a as Z,b as ee}from"./Btn-2hiIT76k.js";import{k as oe,c as se}from"./app-Dh_3ddLE.js";import{u as te}from"./useModal-DVUoJGRd.js";import{u as ae}from"./useSmartPlaylistForm-COXtAFBI.js";import{m as le}from"./index-Dvdk0smA.js";import{_ as re}from"./TextInput.vue_vue_type_script_setup_true_lang-Cn7Fe5WG.js";import{_}from"./FormRow.vue_vue_type_script_setup_true_lang-jRw1p4cD.js";import{S as ne}from"./SelectBox-CnkytuoA.js";import"./common-Qp7bRr50.js";import"./index-BBRRzm9T.js";import"./SoundBars-BQEuboqd.js";import"./usePlaylistManagement-BYa-nJNx.js";import"./downloadService-C6bGKWwx.js";import"./index-SJV2sFs2.js";const ie=["onSubmit","onKeydown"],ue=n("header",null,[n("h1",null,"Edit Smart Playlist")],-1),de={class:"space-y-5"},me=n("option",{value:null},null,-1),ce=["value"],pe={class:"group-container space-y-5 overflow-auto max-h-[480px]"},_e={key:0,class:"form-row"},fe={class:"text-k-text-secondary"},Ie=L({__name:"EditSmartPlaylistForm",emits:["close"],setup(ye,{emit:V}){const{showOverlay:x,hideOverlay:C}=oe(),{toastSuccess:P}=X(),{showConfirmDialog:S}=Z(),{isPlus:B}=se(),l=te().getFromContext("playlist"),D=M(R.state,"folders"),e=q(v.cloneDeep(l)),E=()=>v.isEqual(e.rules,l.rules)&&e.name.trim()===l.name&&e.folder_id===l.folder_id,{Btn:m,FormBase:F,RuleGroup:G,collectedRuleGroups:I,addGroup:N,onGroupChanged:O}=ae(e.rules),c=()=>V("close"),f=async()=>{if(E()){c();return}await S("Discard all changes?")&&c()},T=async()=>{x(),e.rules=I.value;try{await j.update(l,e),P(`Playlist "${l.name}" updated.`),J.emit("PLAYLIST_UPDATED",l),c()}catch(y){ee("dialog").handleHttpError(y)}finally{C()}};return(y,i)=>{const U=H("Icon"),A=h("koel-focus"),K=h("koel-overflow-fade");return r(),w(a(F),{"data-testid":"edit-smart-playlist-form"},{default:s(()=>[n("form",{onSubmit:p(T,["prevent"]),onKeydown:Y(f,["esc"])},[ue,n("main",de,[t(_,{cols:2},{default:s(()=>[t(_,null,{label:s(()=>[u("Name")]),default:s(()=>[g(t(re,{modelValue:e.name,"onUpdate:modelValue":i[0]||(i[0]=o=>e.name=o),name:"name",placeholder:"Playlist name",required:""},null,8,["modelValue"]),[[A]])]),_:1}),t(_,null,{label:s(()=>[u("Folder")]),default:s(()=>[t(ne,{modelValue:e.folder_id,"onUpdate:modelValue":i[1]||(i[1]=o=>e.folder_id=o)},{default:s(()=>[me,(r(!0),d(k,null,b(D.value,o=>(r(),d("option",{key:o.id,value:o.id},z(o.name),9,ce))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),g((r(),d("div",pe,[(r(!0),d(k,null,b(e.rules,(o,$)=>(r(),w(a(G),{key:o.id,group:o,"is-first-group":$===0,onInput:a(O)},null,8,["group","is-first-group","onInput"]))),128)),t(a(m),{class:"btn-add-group",small:"",success:"",title:"Add a new group",uppercase:"",onClick:p(a(N),["prevent"])},{default:s(()=>[t(U,{icon:a(Q)},null,8,["icon"]),u(" Group ")]),_:1},8,["onClick"])])),[[K]]),a(B)?(r(),d("div",_e,[n("label",fe,[t(le,{modelValue:e.own_songs_only,"onUpdate:modelValue":i[2]||(i[2]=o=>e.own_songs_only=o)},null,8,["modelValue"]),u(" Only include songs from my own library ")])])):W("",!0)]),n("footer",null,[t(a(m),{type:"submit"},{default:s(()=>[u("Save")]),_:1}),t(a(m),{class:"btn-cancel",white:"",onClick:p(f,["prevent"])},{default:s(()=>[u("Cancel")]),_:1},8,["onClick"])])],40,ie)]),_:1})}}});export{Ie as default};
