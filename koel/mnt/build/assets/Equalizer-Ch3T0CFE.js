import{t as q,r as m,h as G,Z as z,o as d,n as p,T as o,q as N,w,ad as $,W as y,z as x,a0 as B,a1 as S,B as E,V as C,Y as V,y as K,A as T,au as j}from"./userStore-DI58VgZ6.js";import{l as _,n as g,o as P}from"./app-Dh_3ddLE.js";import{B as M}from"./Btn-2hiIT76k.js";import{S as A}from"./SelectBox-CnkytuoA.js";import{n as D}from"./nouislider-BQRDuRwr.js";import"./index-bkhK2U3_.js";import"./common-Qp7bRr50.js";import"./index-BBRRzm9T.js";const L={class:"flex flex-col items-center min-w-[24px]"},W={class:"mt-2 mb-0 text-left text-sm text-k-text-primary"},U=q({__name:"EqualizerBand",props:{type:{default:"gain"},modelValue:{default:0}},emits:["update:modelValue","commit"],setup(k,{expose:v,emit:n}){const r=k,t=m(),c=G({get:()=>r.modelValue,set:l=>n("update:modelValue",l)}),f=l=>{var i;(i=t.value)==null||i.noUiSlider.set(l),c.value=l};return z(()=>{D.create(t.value,{connect:[!1,!0],start:c.value,range:{min:-20,max:20},orientation:"vertical",direction:"rtl"}),t.value.noUiSlider.on("slide",(l,i)=>{n("update:modelValue",parseFloat(l[i]))}),t.value.noUiSlider.on("change",()=>n("commit"))}),v({updateSliderValue:f}),(l,i)=>(d(),p("article",L,[o("span",{ref_key:"sliderEl",ref:t,class:"slider h-[100px]"},null,512),o("label",W,[N(l.$slots,"default")])]))}}),Y=["onKeydown"],Z=o("option",{value:null,disabled:""},"Preset",-1),H=["value"],I={class:"t-4 b-5 x-4 p-4 flex justify-between rounded-md bg-black/20"},J=o("span",{class:"text-sm h-[100px] w-[20px] flex flex-col justify-between items-center -ml-6 opacity-50"},[o("span",{class:"leading-none text-k-text-primary"},"+20"),o("span",{class:"leading-none text-k-text-primary"},"0"),o("span",{class:"leading-none text-k-text-primary"},"-20")],-1),O={class:"border-t-white/5"},se=q({__name:"Equalizer",emits:["close"],setup(k,{emit:v}){const n=_.bands,r=m(0),t=m(null),c=m(),f=m();let l=!1;w(r,a=>{_.changePreampGain(a),l||(t.value=null)});const i=a=>{_.changeFilterGain(a.node,a.db),l||(t.value=null)};w(t,a=>{a!==null&&F(g.getPresetByName(a)||P[0]),h()});const F=async a=>{var s;l=!0,r.value=a.preamp,(s=c.value)==null||s.updateSliderValue(a.preamp),a.gains.forEach((e,u)=>{n[u].db=e,_.changeFilterGain(n[u].node,e),f.value[u].updateSliderValue(e)}),await $(),l=!1},h=()=>g.saveConfig(t.value,r.value,n.map(a=>a.db)),b=()=>v("close");return z(()=>{const{name:a,preamp:s}=g.getConfig();t.value=a,r.value=s}),(a,s)=>(d(),p("div",{class:"select-none w-full flex flex-col",tabindex:"0",onKeydown:j(b,["esc"])},[o("header",null,[y(A,{modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=e=>t.value=e),class:"!bg-black/30 !text-white",title:"Select equalizer"},{default:x(()=>[Z,(d(!0),p(B,null,S(E(P),e=>(d(),p("option",{key:e.name,value:e.name},C(e.name),9,H))),128))]),_:1},8,["modelValue"])]),o("main",null,[o("div",I,[y(U,{ref_key:"preampBandEl",ref:c,modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=e=>r.value=e),type:"preamp",onCommit:h},{default:x(()=>[V("Preamp")]),_:1},8,["modelValue"]),J,(d(!0),p(B,null,S(E(n),e=>(d(),K(U,{key:e.label,ref_for:!0,ref_key:"filterBandEls",ref:f,modelValue:e.db,"onUpdate:modelValue":[u=>e.db=u,u=>i(e)],onCommit:h},{default:x(()=>[V(C(e.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue"]))),128))])]),o("footer",O,[y(M,{onClick:T(b,["prevent"])},{default:x(()=>[V("Close")]),_:1},8,["onClick"])])],40,Y))}});export{se as default};
