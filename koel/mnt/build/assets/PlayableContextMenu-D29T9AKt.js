import{t as fe,r as be,ac as k,b as h,i as ge,G as P,h as v,L as N,at as _e,f as w,a as Ce,k as he,o as s,y as Pe,z as we,n as i,a0 as c,T as l,A as Se,B as n,U as u,Y as Te,m as Fe,a1 as O,V as L,s as f,p as S,C as Ee}from"./userStore-DI58VgZ6.js";import{c as De}from"./common-Qp7bRr50.js";import{d as xe}from"./downloadService-C6bGKWwx.js";import{u as Me,c as Ae,h as Be,p as T}from"./app-Dh_3ddLE.js";import{u as $e}from"./useContextMenu-uqGsLwl5.js";import{u as Re,a as Ue}from"./Btn-2hiIT76k.js";import{a as Ne,u as Oe}from"./usePlaylistManagement-BYa-nJNx.js";import"./index-bkhK2U3_.js";import"./index-BBRRzm9T.js";import"./index-SJV2sFs2.js";const Le=["onClick"],Qe={key:0},qe={key:1},Ge={class:"has-sub"},ze={class:"submenu menu-add-to context-menu"},Ie=l("li",{class:"separator"},null,-1),Ve={key:3,class:"separator"},We={class:"d-block"},Ye={key:0,class:"relative max-h-48 overflow-y-auto"},He=["onClick"],Ke=l("li",{class:"separator"},null,-1),Xe=l("li",{class:"separator"},null,-1),je=l("li",{class:"separator"},null,-1),Je=l("li",{class:"separator"},null,-1),Ze=l("li",{class:"separator"},null,-1),et=["onClick"],tt=l("li",{class:"separator"},null,-1),at=l("li",{class:"separator"},null,-1),pt=fe({__name:"PlayableContextMenu",setup(st){const{toastSuccess:m,toastError:Q,toastWarning:q}=Re(),{showConfirmDialog:G}=Ue(),{go:y,getRouteParam:F,isCurrentScreen:b}=Me(),{base:z,ContextMenu:I,open:V,close:W,trigger:r}=$e(),{removeFromPlaylist:Y}=Ne(),{isPlus:H}=Ae(),e=be([]),{queueAfterCurrent:E,queueToBottom:p,queueToTop:D,addToFavorites:x,addToExistingPlaylist:K,addToNewPlaylist:M}=Oe(e,W),X=k(h.state,"playlists"),j=k(ge.state,"allows_download"),J=k(P.state,"playables"),Z=k(P,"current"),{currentUserCan:ee}=Be(),g=v(()=>d.value==="songs"&&ee.editSong(e.value)),A=v(()=>e.value.length===1),te=v(()=>e.value.length?e.value[0].playback_state==="Playing":!1),_=v(()=>X.value.filter(({is_smart:t})=>!t)),B=()=>r(async()=>{if(d.value!=="songs")throw"Only songs can be marked as public or private";await f.publicize(e.value),m(`Unmarked ${S(e.value,"song")} as private.`)}),$=()=>r(async()=>{if(d.value!=="songs")throw"Only songs can be marked as public or private";const t=await f.privatize(e.value);if(!t.length){Q("Songs cannot be marked as private if they’part of a collaborative playlist.");return}if(t.length<e.value.length){q("Some songs cannot be marked as private as they’re part of a collaborative playlist.");return}m(`Marked ${S(e.value,"song")} as private.`)}),ae=v(()=>!H.value||N(e.value[0])&&e.value[0].is_public),d=v(()=>_e(e.value)),R=v(()=>{if(d.value!=="songs"||!g.value)return[];const t=Array.from(new Set(e.value.map(a=>a.is_public?"public":"private")));return t.length===2?[{label:"Unmark as Private",handler:B},{label:"Mark as Private",handler:$}]:t[0]==="public"?[{label:"Mark as Private",handler:$}]:[{label:"Unmark as Private",handler:B}]}),se=v(()=>{if(!b("Playlist"))return!1;const t=h.byId(F("id"));return t&&!t.is_smart}),le=v(()=>b("Queue")),U=v(()=>b("Favorites")),oe=()=>r(async()=>{if(e.value.length)switch(e.value[0].playback_state){case"Playing":T.pause();break;case"Paused":await T.resume();break;default:await T.play(e.value[0]);break}}),ie=()=>r(()=>e.value.length&&d.value==="songs"&&w.emit("MODAL_SHOW_EDIT_SONG_FORM",e.value)),ne=t=>r(()=>y(`album/${t.album_id}`)),re=t=>r(()=>y(`artist/${t.artist_id}`)),ue=t=>r(()=>y(`podcasts/${t.podcast_id}`)),ce=t=>r(()=>y(`episodes/${t.id}`)),ve=()=>r(()=>xe.fromPlayables(e.value)),de=()=>r(async()=>{const t=h.byId(F("id"));t&&await Y(t,e.value)}),me=()=>r(()=>P.unqueue(e.value)),ye=()=>r(()=>Ee.unlike(e.value)),pe=()=>r(async()=>{await De(f.getShareableUrl(e.value[0])),m("URL copied to clipboard.")}),ke=()=>r(async()=>{await G("Delete selected song(s) from the filesystem? This action is NOT reversible!")&&(await f.deleteFromFilesystem(e.value),m(`Deleted ${S(e.value,"song")} from the filesystem.`),w.emit("SONGS_DELETED",e.value))});return w.on("PLAYABLE_CONTEXT_MENU_REQUESTED",async({pageX:t,pageY:a},C)=>{e.value=Ce(C),await V(a,t)}),(t,a)=>{const C=he("koel-overflow-fade");return s(),Pe(n(I),{ref_key:"base",ref:z,"data-testid":"song-context-menu","extra-class":"song-menu"},{default:we(()=>[A.value?(s(),i(c,{key:0},[l("li",{onClick:Se(oe,["stop","prevent"])},[te.value?(s(),i("span",Qe,"Pause")):(s(),i("span",qe,"Play"))],8,Le),n(N)(e.value[0])?(s(),i(c,{key:0},[l("li",{onClick:a[0]||(a[0]=o=>ne(e.value[0]))},"Go to Album"),l("li",{onClick:a[1]||(a[1]=o=>re(e.value[0]))},"Go to Artist")],64)):(s(),i(c,{key:1},[l("li",{onClick:a[2]||(a[2]=o=>ue(e.value[0]))},"Go to Podcast"),l("li",{onClick:a[3]||(a[3]=o=>ce(e.value[0]))},"See Episode Description")],64))],64)):u("",!0),l("li",Ge,[Te(" Add To "),l("ul",ze,[J.value.length?(s(),i(c,{key:0},[Z.value?(s(),i("li",{key:0,onClick:a[4]||(a[4]=(...o)=>n(E)&&n(E)(...o))},"After Current")):u("",!0),l("li",{onClick:a[5]||(a[5]=(...o)=>n(p)&&n(p)(...o))},"Bottom of Queue"),l("li",{onClick:a[6]||(a[6]=(...o)=>n(D)&&n(D)(...o))},"Top of Queue")],64)):(s(),i("li",{key:1,onClick:a[7]||(a[7]=(...o)=>n(p)&&n(p)(...o))},"Queue")),U.value?u("",!0):(s(),i(c,{key:2},[Ie,l("li",{onClick:a[8]||(a[8]=(...o)=>n(x)&&n(x)(...o))},"Favorites")],64)),_.value.length?(s(),i("li",Ve)):u("",!0),l("template",We,[_.value.length?Fe((s(),i("ul",Ye,[(s(!0),i(c,null,O(_.value,o=>(s(),i("li",{key:o.id,onClick:lt=>n(K)(o)},L(o.name),9,He))),128))])),[[C]]):u("",!0)]),Ke,l("li",{onClick:a[9]||(a[9]=(...o)=>n(M)&&n(M)(...o))},"New Playlist…")])]),le.value?(s(),i(c,{key:1},[Xe,l("li",{onClick:me},"Remove from Queue"),je],64)):u("",!0),U.value?(s(),i(c,{key:2},[Je,l("li",{onClick:ye},"Remove from Favorites")],64)):u("",!0),R.value.length?(s(),i(c,{key:3},[Ze,(s(!0),i(c,null,O(R.value,o=>(s(),i("li",{key:o.label,onClick:o.handler},L(o.label),9,et))),128))],64)):u("",!0),g.value?(s(),i("li",{key:4,onClick:ie},"Edit…")):u("",!0),j.value?(s(),i("li",{key:5,onClick:ve},"Download")):u("",!0),A.value&&ae.value?(s(),i("li",{key:6,onClick:pe},"Copy Shareable URL")):u("",!0),se.value?(s(),i(c,{key:7},[tt,l("li",{onClick:de},"Remove from Playlist")],64)):u("",!0),g.value?(s(),i(c,{key:8},[at,l("li",{onClick:ke},"Delete from Filesystem")],64)):u("",!0)]),_:1},512)}}});export{pt as default};
