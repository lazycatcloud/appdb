import{t as k,v as w,r as b,h as g,x as T,o as e,n as l,y as v,z as I,Y as f,A as $,U as m,W as x,B as o,_ as B,a0 as M,a1 as O,T as s,u as L,V as A,Z as D,O as E,f as N,k as V,m as U,au as K,a7 as j,a8 as z}from"./userStore-DI58VgZ6.js";import{u as F}from"./useModal-DVUoJGRd.js";import{B as S,a as H,b as Y}from"./Btn-2hiIT76k.js";import{ay as W,aA as Z,h as q}from"./index-bkhK2U3_.js";import{c as G}from"./common-Qp7bRr50.js";import{i as C}from"./app-Dh_3ddLE.js";import{_ as J}from"./index-Dvdk0smA.js";import"./index-BBRRzm9T.js";import"./TextInput.vue_vue_type_script_setup_true_lang-Cn7Fe5WG.js";import"./usePlaylistManagement-BYa-nJNx.js";import"./downloadService-C6bGKWwx.js";import"./SoundBars-BQEuboqd.js";import"./index-SJV2sFs2.js";const Q={key:1,class:"text-k-text-secondary text-[0.95rem]"},X=k({__name:"InvitePlaylistCollaborators",props:{playlist:{}},setup(r){const p=r,{playlist:t}=w(p),a=b(!1),u=b(!1),n=g(()=>!a.value&&!u.value),i=async()=>{a.value=!0;try{await G(await C.createInviteLink(t.value)),u.value=!0,setTimeout(()=>u.value=!1,5e3)}finally{a.value=!1}};return(y,_)=>{const h=T("Icon");return e(),l("span",null,[n.value?(e(),v(S,{key:0,small:"",success:"",onClick:$(i,["prevent"])},{default:I(()=>[f("Invite")]),_:1},8,["onClick"])):m("",!0),u.value?(e(),l("span",Q,[x(h,{icon:o(W),class:"text-k-success mr-1"},null,8,["icon"]),f(" Link copied to clipboard! ")])):m("",!0),a.value?(e(),v(h,{key:2,icon:o(Z),class:"text-k-success",spin:""},null,8,["icon"])):m("",!0)])}}}),ee={},te={class:"skeleton flex flex-col w-full gap-3"};function oe(r,p){return e(),l("div",te,[(e(),l(M,null,O(3,t=>s("div",{key:t,class:"rounded-md h-[47px] pulse"})),64))])}const ae=B(ee,[["render",oe]]),se={class:"flex items-center justify-center w-full gap-3 py-2 px-3 rounded-md transition-colors duration-200 ease-in-out bg-k-bg-secondary border border-k-border hover:border hover:border-white/15"},le={class:"avatar"},re={class:"flex-1"},ne={class:"role text-k-text-secondary text-right flex-[0_0_104px] uppercase"},ie={key:0,class:"owner"},ce={key:1,class:"contributor"},ue={key:0,class:"actions flex-[0_0_72px] text-right"},de=k({__name:"PlaylistCollaboratorListItem",props:{collaborator:{},removable:{type:Boolean},manageable:{type:Boolean},role:{}},emits:["remove"],setup(r,{emit:p}){const t=r,{collaborator:a,removable:u,role:n}=w(t),{currentUser:i}=L();return(y,_)=>{const h=T("Icon");return e(),l("li",se,[s("span",le,[x(J,{user:o(a),width:"32"},null,8,["user"])]),s("span",re,[f(A(o(a).name)+" ",1),o(a).id===o(i).id?(e(),v(h,{key:0,icon:o(q),class:"text-k-highlight ml-1",title:"This is you!"},null,8,["icon"])):m("",!0)]),s("span",ne,[o(n)==="owner"?(e(),l("span",ie,"Owner")):(e(),l("span",ce,"Contributor"))]),y.manageable?(e(),l("span",ue,[o(u)?(e(),v(S,{key:0,danger:"",small:"",onClick:_[0]||(_[0]=$(c=>p("remove"),["prevent"]))},{default:I(()=>[f("Remove")]),_:1})):m("",!0)])):m("",!0)])}}}),pe=B(de,[["__scopeId","data-v-5cdc0c38"]]),_e={key:1,class:"w-full space-y-3"},me=k({__name:"PlaylistCollaboratorList",props:{playlist:{}},setup(r){const p=r,{playlist:t}=w(p),{currentUser:a}=L(),{showConfirmDialog:u}=H();let n=b([]);const i=b(!1),y=g(()=>{var c;return((c=a.value)==null?void 0:c.id)===t.value.user_id}),_=async()=>{i.value=!0;try{n.value=E.sortBy(await C.fetchCollaborators(t.value),({id:c})=>c===a.value.id?0:c===t.value.user_id?1:2)}finally{i.value=!1}},h=async c=>{if(await u(`Remove ${c.name} as a collaborator? This will remove their contributions as well.`))try{n.value=n.value.filter(({id:d})=>d!==c.id),await C.removeCollaborator(t.value,c),N.emit("PLAYLIST_COLLABORATOR_REMOVED",t.value)}catch(d){Y().handleHttpError(d)}};return D(async()=>await _()),(c,P)=>i.value?(e(),v(ae,{key:0})):(e(),l("ul",_e,[(e(!0),l(M,null,O(o(n),d=>(e(),v(pe,{key:d.id,collaborator:d,manageable:y.value,removable:y.value&&d.id!==o(t).user_id,role:d.id===o(t).user_id?"owner":"contributor",onRemove:we=>h(d)},null,8,["collaborator","manageable","removable","role","onRemove"]))),128))]))}}),R=r=>(j("data-v-af6ed60d"),r=r(),z(),r),ve=["onKeydown"],fe=R(()=>s("header",null,[s("h1",null,"Playlist Collaboration")],-1)),ye=R(()=>s("p",{class:"text-k-text-secondary"},[f(" Collaborative playlists allow multiple users to contribute. "),s("br"),f(" Note: Songs added to a collaborative playlist are made accessible to all users, and you cannot mark a song as private if itâ€™s still part of a collaborative playlist. ")],-1)),he={class:"space-y-5"},be={class:"flex text-xl mt-6 mb-1 items-center"},xe=R(()=>s("span",{class:"flex-1"},"Current Collaborators",-1)),ke={class:"collaborators-wrapper overflow-auto"},Ce=k({__name:"PlaylistCollaborationModal",emits:["close"],setup(r,{emit:p}){const t=F().getFromContext("playlist"),{currentUser:a}=L(),u=g(()=>{var i;return((i=a.value)==null?void 0:i.id)===t.user_id}),n=()=>p("close");return(i,y)=>{const _=V("koel-overflow-fade");return e(),l("div",{class:"collaboration-modal max-w-[640px]",tabindex:"0",onKeydown:K(n,["esc"]),"data-testid":"playlist-collaboration"},[fe,s("main",null,[ye,s("section",he,[s("h2",be,[xe,u.value?(e(),v(X,{key:0,playlist:o(t)},null,8,["playlist"])):m("",!0)]),U((e(),l("div",ke,[x(me,{playlist:o(t)},null,8,["playlist"])])),[[_]])])]),s("footer",null,[x(S,{onClick:$(n,["prevent"])},{default:I(()=>[f("Close")]),_:1},8,["onClick"])])],40,ve)}}}),Ee=B(Ce,[["__scopeId","data-v-af6ed60d"]]);export{Ee as default};
