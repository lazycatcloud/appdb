function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/EpisodeProgress-BJoRGFxi.js","assets/userStore-DI58VgZ6.js","assets/userStore-CkW9hTsr.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{t as J,a4 as de,a5 as pe,v as ve,h as c,aC as G,x as Z,o,n as q,y as i,B as l,U as x,T as a,A as I,V as S,X as ee,f as _e,F as fe,G as F,O as te,s as N,a7 as me,a8 as he,_ as O,ax as xe,a3 as ge,r as w,w as ye,ad as ke,K as we,k as X,z as d,m as $,W as P,Y as be,a0 as Pe,a1 as Se,g as Y}from"./userStore-DI58VgZ6.js";import{p as ae,F as Ee,S as Ce,B as Te,i as Be,V as De,b as Ie}from"./index-Dvdk0smA.js";import{aa as Le,ao as $e,t as se,v as oe,M as He,a3 as Fe,ap as ze}from"./index-bkhK2U3_.js";import{p as b,e as Ve,u as Re}from"./app-Dh_3ddLE.js";import{a as Ae,b as K,B as H}from"./Btn-2hiIT76k.js";import{S as Me}from"./ScreenHeaderSkeleton-BPPtSZSV.js";import"./TextInput.vue_vue_type_script_setup_true_lang-Cn7Fe5WG.js";import"./usePlaylistManagement-BYa-nJNx.js";import"./common-Qp7bRr50.js";import"./downloadService-C6bGKWwx.js";import"./SoundBars-BQEuboqd.js";import"./index-SJV2sFs2.js";import"./index-BBRRzm9T.js";const Ne=y=>(me("data-v-0e1099ed"),y=y(),he(),y),qe=["href","onContextmenu"],Oe=["onClick"],Ue=["src"],Qe=Ne(()=>a("span",{class:"absolute top-0 left-0 w-full h-full group-hover:bg-black/40 z-10"},null,-1)),je={class:"absolute flex opacity-0 items-center justify-center w-[48px] aspect-square rounded-full top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-k-highlight group-hover:opacity-100 duration-500 transition z-20"},We={class:"flex-1"},Ge=["datetime","title"],Xe=["title"],Ye=["innerHTML"],Ke={class:"md:flex-[0_0_122px] text-sm text-k-text-secondary flex md:flex-col items-center justify-center w-full"},Je={class:"block md:mb-2"},Ze={class:"px-4 flex-1 md:flex-grow-0 md:w-full"},et=J({__name:"EpisodeItem",props:{episode:{},podcast:{}},setup(y){const L=y,z=de(()=>pe(()=>import("./EpisodeProgress-BJoRGFxi.js"),__vite__mapDeps([0,1,2]))),{episode:t,podcast:E}=ve(L),{startDragging:V}=Ve("playables"),p=c(()=>{const r=new Date(t.value.created_at);return(Date.now()-r.getTime())/(1e3*60*60*24)<31?Le(r):r.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}),v=c(()=>E.value.state.progresses[t.value.id]||0),g=c(()=>{if(v.value===0)return G(t.value.length);const r=t.value.length-v.value;return r===0?0:`${G(r)} left`}),_=c(()=>g.value!==0&&t.value.length&&v.value),m=c(()=>E.value.state.current_episode===t.value.id),s=c(()=>ae.sanitize(t.value.episode_description)),n=r=>V(r,t.value),C=r=>_e.emit("PLAYABLE_CONTEXT_MENU_REQUESTED",r,t.value),k=c(()=>t.value.playback_state==="Playing"),R=async()=>{if(k.value)return b.pause();if(t.value.playback_state==="Paused")return b.resume();fe.continuous_playback&&F.replaceQueueWith(te.orderBy(await N.fetchForPodcast(E.value.id),"created_at")),await b.play(t.value,v.value>=t.value.length?0:v.value)};return(r,U)=>{const T=Z("Icon");return o(),q("a",{"data-testid":"episode-item",class:ee(["group relative flex flex-col md:flex-row gap-4 px-6 py-5 !text-k-text-primary hover:bg-white/10 duration-200",m.value&&"current"]),href:`/#/episodes/${l(t).id}`,onContextmenu:I(C,["prevent"]),onDragstart:n},[m.value?(o(),i(T,{key:0,icon:l($e),size:"xl",class:"absolute -top-1 right-3 text-k-accent"},null,8,["icon"])):x("",!0),a("button",{class:"hidden md:block md:flex-[0_0_128px] relative overflow-hidden rounded-lg active:scale-95",role:"button",onClick:I(R,["prevent"])},[a("img",{src:l(t).episode_image,alt:"Episode thumbnail",class:"w-[128px] aspect-square object-cover",loading:"lazy"},null,8,Ue),Qe,a("span",je,[k.value?(o(),i(T,{key:0,icon:l(se),class:"text-white",size:"2xl"},null,8,["icon"])):(o(),i(T,{key:1,icon:l(oe),class:"ml-1 text-white",size:"2xl"},null,8,["icon"]))])],8,Oe),a("div",We,[a("time",{datetime:l(t).created_at,title:l(t).created_at,class:"block uppercase text-sm mb-1 text-k-text-secondary"},S(p.value),9,Ge),a("h3",{class:"text-xl",title:l(t).title},S(l(t).title),9,Xe),a("div",{class:"description text-k-text-secondary mt-3 line-clamp-3",innerHTML:s.value},null,8,Ye)]),a("div",Ke,[a("span",Je,S(g.value?g.value:"Played"),1),a("div",Ze,[_.value?(o(),i(l(z),{key:0,episode:l(t),position:v.value},null,8,["episode","position"])):x("",!0)])])],42,qe)}}}),tt=O(et,[["__scopeId","data-v-0e1099ed"]]),at={},st={class:"skeleton flex gap-4 px-6 py-5 !text-k-text-primary"},ot=xe('<aside class="flex-[0_0_128px]"><div class="pulse rounded-lg aspect-square"></div></aside><main class="flex-1 pt-3"><h3 class="pulse w-2/3 h-8"></h3><div class="mt-4"><div class="pulse w-full h-5 mb-2"></div><div class="pulse w-2/3 h-5"></div><div class="pulse w-1/3 h-5 mt-4"></div></div></main>',2),lt=[ot];function nt(y,L){return o(),q("article",st,lt)}const it=O(at,[["render",nt]]),rt=["title"],ct={class:"relative aspect-square block rounded-md overflow-hidden","data-testid":"podcast-thumbnail"},ut={class:"pointer-events-none"},dt=["src"],pt={class:"text-2xl text-k-text-primary mb-1"},vt=["title","innerHTML"],_t={class:"flex gap-2 flex-wrap"},ft={class:"-m-6 min-h-full flex flex-col flex-1 overflow-auto divide-y divide-white/10"},mt=J({__name:"PodcastScreen",setup(y){const{showConfirmDialog:L}=Ae(),{onScreenActivated:z,getRouteParam:t,go:E,triggerNotFound:V}=Re(),p=ge({overflown:!1,expanded:!1,content:""}),v=w(),g=w("expanded"),_=w(!1),m=w(),s=w(),n=w(),C=w("");let k=null;const R=async()=>{[s.value,n.value]=await Promise.all([Y.resolve(m.value),N.fetchForPodcast(m.value)])};ye(m,async e=>{var u;if(!(!e||_.value)){_.value=!0;try{await R(),k=new Ee(n.value,{keys:["title","episode_description"]}),p.content=ae.sanitize(((u=s.value)==null?void 0:u.description)||""),await ke(),p.overflown=v.value.scrollHeight>v.value.clientHeight}catch(h){K().handleHttpError(h,{404:()=>V()})}finally{_.value=!1}}});const r=()=>{p.overflown&&(p.expanded=!p.expanded,v.value.classList.toggle("line-clamp-3"))},U=c(()=>p.overflown?p.expanded?"Collapse":"Expand":""),T=c(()=>{var e;return n.value?C.value?((e=k==null?void 0:k.search(C.value))==null?void 0:e.map(u=>u.item))||[]:n.value:[]}),Q=c(()=>{var e;return!!((e=s.value)!=null&&e.state.current_episode)}),j=c(()=>{const e=F.current;return e&&we(e)&&e.podcast_id===m.value}),A=c(()=>j.value?F.current.playback_state==="Playing":!1),le=c(()=>g.value==="collapsed"||A.value?"":Q.value?"Continue":"Start Listening"),ne=async()=>{var e,u,h;if(A.value){b.pause();return}if(j.value){await b.resume();return}if(Q.value){const B=(e=n.value)==null?void 0:e.find(D=>{var f;return D.id===((f=s.value)==null?void 0:f.state.current_episode)});if(!B)return;await b.play(B,((u=s.value)==null?void 0:u.state.progresses[B.id])||0);return}(h=n.value)!=null&&h.length&&(F.replaceQueueWith(te.orderBy(n.value,"created_at")),await b.playFirstInQueue())},ie=async()=>{if(!_.value){_.value=!0;try{n.value=await N.fetchForPodcast(m.value,!0)}catch(e){K().handleHttpError(e)}finally{_.value=!1}}},re=async()=>{var e;await L(`Unsubscribe from ${(e=s.value)==null?void 0:e.title}?`)&&(await Y.unsubscribe(s.value),E(-1))};let M=0;const ce=e=>{const u=e.target;u.scrollTop>512&&M<512?g.value="collapsed":u.scrollTop<512&&M>512&&(g.value="expanded"),M=u.scrollTop},ue=e=>C.value=e;return z("Podcast",()=>m.value=t("id")),(e,u)=>{const h=Z("Icon"),B=X("koel-new-tab"),D=X("koel-tooltip");return o(),i(Ie,null,{header:d(()=>[_.value&&!s.value?(o(),i(Me,{key:0})):x("",!0),s.value?(o(),i(Ce,{key:1,layout:g.value},{thumbnail:d(()=>[a("article",ct,[a("div",ut,[a("img",{src:s.value.image,alt:"Podcast thumbnail"},null,8,dt)])])]),meta:d(()=>[a("div",null,[a("p",pt,S(s.value.author),1),$(a("div",{ref_key:"descriptionEl",ref:v,class:ee([{"cursor-pointer":p.overflown},"leading-5 line-clamp-3"]),title:U.value,onClick:r,innerHTML:p.content},null,10,vt),[[B]])])]),controls:d(()=>{var f,W;return[a("div",_t,[(f=n.value)!=null&&f.length?(o(),i(H,{key:0,highlight:"",uppercase:"",onClick:I(ne,["prevent"])},{default:d(()=>[P(h,{icon:A.value?l(se):l(oe),"fixed-width":""},null,8,["icon"]),be(" "+S(le.value),1)]),_:1},8,["onClick"])):x("",!0),P(Te,{uppercase:""},{default:d(()=>[n.value?$((o(),i(H,{key:0,success:"",onClick:I(ie,["prevent"])},{default:d(()=>[P(h,{icon:l(He),"fixed-width":""},null,8,["icon"])]),_:1},8,["onClick"])),[[D,"Refresh"]]):x("",!0),$((o(),i(H,{danger:"",uppercase:"",onClick:I(re,["prevent"])},{default:d(()=>[P(h,{icon:l(Fe),"fixed-width":""},null,8,["icon"])]),_:1},8,["onClick"])),[[D,"Unsubscribe"]])]),_:1}),(W=n.value)!=null&&W.length?(o(),i(Be,{key:1,onChange:ue})):x("",!0),$((o(),i(H,{tag:"a",gray:"",href:s.value.link,target:"_blank"},{default:d(()=>[P(h,{icon:l(ze),"fixed-width":""},null,8,["icon"])]),_:1},8,["href"])),[[D,"Visit podcast website"]])])]}),default:d(()=>[a("span",{title:s.value.title},S(s.value.title),9,rt)]),_:1},8,["layout"])):x("",!0)]),default:d(()=>[a("div",ft,[_.value&&!n.value&&!s.value?(o(),q(Pe,{key:0},Se(5,f=>P(it,{key:f})),64)):x("",!0),n.value&&s.value?(o(),i(De,{key:1,"item-height":161.5,items:T.value,onScroll:ce},{default:d(({item:f})=>[(o(),i(tt,{podcast:s.value,episode:f,key:f.id},null,8,["podcast","episode"]))]),_:1},8,["items"])):x("",!0)])]),_:1})}}}),Dt=O(mt,[["__scopeId","data-v-13072043"]]);export{Dt as default};
