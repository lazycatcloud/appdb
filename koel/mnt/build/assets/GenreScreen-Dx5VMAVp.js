import{a2 as J}from"./index-bkhK2U3_.js";import{t as K,r as i,h as g,aC as Q,Z as X,w as $,f as ee,x as ae,o,y as t,z as l,B as e,az as ne,W as P,U as v,Y as b,T as f,V as S,am as oe,p as te,s as C}from"./userStore-DI58VgZ6.js";import{b as le}from"./Btn-2hiIT76k.js";import{u as se,p as w}from"./app-Dh_3ddLE.js";import{u as re,c as ue,S as ce,d as ie,g as me,b as de,h as pe}from"./index-Dvdk0smA.js";import{S as ge}from"./ScreenHeaderSkeleton-BPPtSZSV.js";import"./common-Qp7bRr50.js";import"./index-BBRRzm9T.js";import"./TextInput.vue_vue_type_script_setup_true_lang-Cn7Fe5WG.js";import"./usePlaylistManagement-BYa-nJNx.js";import"./downloadService-C6bGKWwx.js";import"./SoundBars-BQEuboqd.js";import"./index-SJV2sFs2.js";const ve={class:"text-thin"},B=500,Te=K({__name:"GenreScreen",setup(fe){const{SongList:G,ControlsToggle:L,ThumbnailStack:R,headerLayout:T,songs:s,songList:V,thumbnails:x,showingControls:m,isPhone:N,onPressEnter:A,playSelected:E,onScrollBreakpoint:H}=re(i([]),{type:"Genre"},{sortable:!0,filterable:!1}),{SongListControls:F,config:U}=ue("Genre"),{getRouteParam:q,go:z,onRouteChanged:D}=se();let y="title",h="asc";const r=i(null),n=i(null),u=i(!1),c=i(1),I=g(()=>c.value!==null),O=g(()=>u.value&&s.value.length===0),W=g(()=>{var a;return Q(((a=n.value)==null?void 0:a.length)??0)}),M=async(a,d)=>{c.value=1,s.value=[],y=a,h=d,await p()},p=async()=>{if(!(!I.value||u.value)){u.value=!0;try{let a;[n.value,a]=await Promise.all([pe.fetchOne(r.value),C.paginateForGenre(r.value,{sort:y,order:h,page:c.value})]),c.value=a.nextPage,s.value.push(...a.songs)}catch(a){le("dialog").handleHttpError(a)}finally{u.value=!1}}},k=async()=>{n.value=null,c.value=1,s.value=[],await p()},_=()=>q("name")??null;D(a=>{a.screen==="Genre"&&(r.value=_())});const Y=async()=>{n.value&&(n.value.song_count<=B?w.queueAndPlay(s.value,!0):w.queueAndPlay(await C.fetchRandomForGenre(n.value,B)),z("queue"))};return X(()=>r.value=_()),$(r,async()=>r.value&&await k()),ee.on("SONGS_UPDATED",async()=>n.value&&await k()),(a,d)=>{const Z=ae("Icon");return o(),t(de,null,{header:l(()=>[n.value?(o(),t(ce,{key:0,layout:e(T)},ne({thumbnail:l(()=>[P(e(R),{thumbnails:e(x)},null,8,["thumbnails"])]),controls:l(()=>[!e(N)||e(m)?(o(),t(e(F),{key:0,config:e(U),onPlayAll:Y,onPlaySelected:e(E)},null,8,["config","onPlaySelected"])):v("",!0)]),default:l(()=>[b(" Genre: "),f("span",ve,S(decodeURIComponent(r.value)),1),e(s).length?(o(),t(e(L),{key:0,modelValue:e(m),"onUpdate:modelValue":d[0]||(d[0]=j=>oe(m)?m.value=j:null)},null,8,["modelValue"])):v("",!0)]),_:2},[n.value?{name:"meta",fn:l(()=>[f("span",null,S(e(te)(n.value.song_count,"song")),1),f("span",null,S(W.value),1)]),key:"0"}:void 0]),1032,["layout"])):(o(),t(ge,{key:1}))]),default:l(()=>[O.value?(o(),t(ie,{key:0,class:"-m-6"})):(o(),t(e(G),{key:1,ref_key:"songList",ref:V,class:"-m-6",onSort:M,"onPress:enter":e(A),onScrollBreakpoint:e(H),onScrolledToEnd:p},null,8,["onPress:enter","onScrollBreakpoint"])),!e(s).length&&!u.value?(o(),t(me,{key:2},{icon:l(()=>[P(Z,{icon:e(J)},null,8,["icon"])]),default:l(()=>[b(" No songs in this genre. ")]),_:1})):v("",!0)]),_:1})}}});export{Te as default};
